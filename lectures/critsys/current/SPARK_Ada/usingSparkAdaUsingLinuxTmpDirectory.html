<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title>Using SPARK Ada using Linux Tmp Directory</title>
  </head>

  <body bgcolor="#ffffff" text="#000000">
    <h1>Using SPARK Ada using Linux Tmp Directory</h1>

<ul>
<li> The following instructions are a work around in case SPARK Ada becomes
slow due to problems with the shared home directory.
<ul>
<li> This might be caused because of temporary networking problems or
the server being overloaded.
</ul>
<li> One solution is to work on the tmp directory, which is local to the machine.
<li> Note that this requires frequent backups, since the content of the tmp
directory are frequently deleted. <br>
However the tmp directory has the advantage that non-root users have direct
access to it.
<li> In the following we assume the files from a SPARK Ada project are
in ~/labCurrentFiles
<li> First delete any files generated by SPARK Ada, to make the directory
small.
<ul>
<li> Delete the directory gnatprove, saved_runs, and the executable files
main or main.exe.
<ul>
<li> Be careful with the following commands, because they delete everything
without any warning
<li> You can as well replace <code>/bin/rm</code> in the following by 
<code>rm -i</code><br>
and <code>/bin/rm -r</code>  by  <code>rm -i -r</code><br>
That has the effect of asking for a yes for each file (which might
be too time consuing for the directories which contain many files).
<Li> Done by executing in a command shell the following lines<br>
<code>
/bin/rm -r ~/labCurrentFiles/gnatprove<br>
/bin/rm -r ~/labCurrentFiles/saved_runs<br>
/bin/rm ~/labCurrentFiles/main<br>
/bin/rm ~/labCurrentFiles/main.exe<br>
</code>
<br>
If you get  file not found error then the file in question wasn't there,
so that should be fine (if you are working with the correct directory).
</ul>
<li> Now we create the tmp directory by using the command<br>
<code>mkdir /tmp/labCurrentFiles</code>
<li> We can sync the directory using rsync<br>
First carry out a Dry run (which shows what the system will do but
doesn't execute it) using command<br>
<code>rsync -arvn ~/labCurrentFiles/ /tmp/labCurrentFiles/</code><br>
<li> If everything is fine, then execute a full run using the command:<br>
<code>rsync -arv ~/labCurrentFiles/ /tmp/labCurrentFiles/</code><br>
<li> I always repeat the previous command - it usually should not
do anything anymore.
<li> Now run SPARK Ada starting with the <code>main.gpr</code> file in question in the
directory <br>
<code>/tmp/labCurrentFiles/</code>
<li> Regularly back the tmp directory up the home directory<br> 
(note that in case of a crash of the machine
the content of the tmp directory will be lost whereas your home directoy
should be fine)<br>
The command is:<br>
<code>rsync -arv  /tmp/labCurrentFiles/ ~/labCurrentFiles/</code>
<li> If the server is slow this might take some time.
<li> When you are finishing carry out another rsync by executing the command:<br>
<code>rsync -arv  /tmp/labCurrentFiles/ ~/labCurrentFiles/</code>
<li> And then (<strong>Only if this was successful, and everything is safely backed up</strong>) remove the tmp directory by 
using the command:<br>
<code>/bin/rm -r /tmp/labCurrentFiles/</code>
<li> Note removing the tmp directory is crucial, since anybody using
your machine later might, unless the content of the tmp directory is deleted,
have access to your file<br> 
(unless you were more restrictive with your read and write
permissions - this is recommended to set all files to readable and writable
by the user only, but is not covered in the current instructions).
<li> Check everything is empty using the command<br>
<code>ls /tmp/labCurrentFiles</code><br>
This command should return: file not found.
</ul>
</ul>
